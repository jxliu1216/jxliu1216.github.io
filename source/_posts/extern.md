---
title: C++关键字之extern
date: 2021-12-21 22:12:13
tags:
- C++
categories: extern
---

extern关键字可以作用于全局变量，函数，或者是模板声明，它表明被作用的符号具有外部链接性。

### 1. 声明与定义

**声明：**声明用于向程序表明变量的名字或者是函数原型（也称函数申明）。对于变量声明，它表明了变量的名字和类型；对于函数声明，它表明了函数的名字，参数以及返回值类型。

**定义：**是分配内存空间的过程，并且可以指定变量的初值。

对于变量而言，定义一个变量的时候，显示地指出了它的类型，并为它创建了存储空间和赋予初值，同时也指定了变量的名字，因此，变量的定义过程也是一个声明过程。对于一个函数而言，函数定义需要包含函数头和函数体。同样地，对于类而言，类的定义需要包含类名和罗列出类成员。

例如：

```c++
int i;      // 既是定义，也是声明
int func(int x);    // 函数声明
int show(int x) { return x; } // 函数定义
class C;    // 类声明
class D {
public:
    void show();
}  // 类定义
```

关于声明和定义的一个重要规则：**可以有多次声明，但是只能由一次定义，**也称为“One Definition Rule (ODR)”。

### 2. 内部链接性（internal linkage）和外部链接性（external linkage）

对于一个C++程序而言，它通常由多个独立的CPP文件编译而成。编译器首先对每个CPP文件单独编译，然后通过链接器（linker）将单独编译的结果合并为一个程序。当ODR规则被打破时，链接器将会报错，链接器会提示相同的名字在不同的源文件中被重复定义。

在某些情况下，我们可能必须声明一个全局变量。在这种情况下，我们需要告诉编译器和链接器这个变量的链接属性（linkage），链接属性决定该变量仅是对当前所在文件有效，还是对所有源文件均有效。链接属性仅针对全局变量有效。

链接属性有两种：内部链接性和外部链接性。具有外部链接性的变量，可以被程序中的所有源文件识别；而具有内部链接性或者无链接性（no linkage）的变量仅在其作用域内有效。定义在全局空间的非const变量和函数具有外部链接性。对于只有内部链接性的变量和函数，在其他源文件中可以出现相同名字的函数或者变量。

使用static可以强制使得全局变量和全局空间内的函数变为内部链接，即仅在其定义的源文件中可见。

### 3. extern

